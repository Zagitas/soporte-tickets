<div class="page">
  <div class="page-container">
    <nz-page-header class="page-header">
      <nz-page-header-title>New ticket</nz-page-header-title>
      <nz-page-header-subtitle>Register a support request</nz-page-header-subtitle>
    </nz-page-header>

    <nz-card class="form-card">
      <form nz-form nzLayout="vertical" [formGroup]="form" (ngSubmit)="submit()" class="ticket-form">
        <div nz-row [nzGutter]="16">
          <!-- Request Date -->
          <div nz-col [nzXs]="24" [nzMd]="12">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Request Date</nz-form-label>
              <nz-form-control [nzErrorTip]="'Select a request date'">
                <nz-date-picker
                  class="full-width-datepicker"
                  formControlName="requestDate"
                  nzStyle="width: 100%"
                  nzPlaceHolder="Select request date">
                </nz-date-picker>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Support Type -->
          <div nz-col [nzXs]="24" [nzMd]="12">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Support Type</nz-form-label>
              <nz-form-control [nzErrorTip]="'Select a support type'">
                <nz-select
                  formControlName="supportType"
                  nzPlaceHolder="Select support type"
                  nzAllowClear>
                  <nz-option
                    *ngFor="let s of supportTypes"
                    [nzLabel]="s.label"
                    [nzValue]="s.value || s.label">
                  </nz-option>
                </nz-select>
                <div class="hint">Choose the type of support required.</div>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Project -->
          <div nz-col [nzXs]="24" [nzMd]="12">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Project</nz-form-label>
              <nz-form-control [nzErrorTip]="'Selecciona un proyecto'">
                <nz-select formControlName="projectSlug" nzPlaceHolder="Select a project" nzAllowClear>
                  <nz-option *ngFor="let p of projects" [nzLabel]="p.label" [nzValue]="p.value || p.label"></nz-option>
                </nz-select>
                <div class="hint">Choose the project related to this ticket.</div>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Priority -->
          <div nz-col [nzXs]="24" [nzMd]="12">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Priority</nz-form-label>
              <nz-form-control [nzErrorTip]="'Selecciona una prioridad'">
                <nz-select formControlName="priority" nzPlaceHolder="Select a priority" nzAllowClear>
                  <nz-option *ngFor="let p of priorities" [nzLabel]="p.label" [nzValue]="p.value"></nz-option>
                </nz-select>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Title -->
          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Title</nz-form-label>
              <nz-form-control [nzErrorTip]="'At least 5 characters'">
                <input nz-input formControlName="title" placeholder="Enter a descriptive title" />
                <div class="hint">At least 5 characters.</div>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Description -->
          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label [nzRequired]="true">Description</nz-form-label>
              <nz-form-control [nzErrorTip]="'Description is too short'">
                <textarea nz-input formControlName="description" rows="4" placeholder="Describe the issue in detail"></textarea>
                <div class="hint">Give enough context; minimum {{ MIN_DESC }} characters.</div>
              </nz-form-control>
            </nz-form-item>
          </div>

          <!-- Attachments -->
          <div nz-col [nzSpan]="24">
            <nz-form-item>
              <nz-form-label>Attachments</nz-form-label>
              <nz-form-control>
                <nz-upload
                  nzType="drag"
                  nzMultiple
                  [nzFileList]="fileList"
                  [nzBeforeUpload]="beforeUpload"
                  [nzRemove]="removeFile"
                  [nzShowUploadList]="{ showPreviewIcon: false, showRemoveIcon: true }">
                  <p class="ant-upload-drag-icon"><span nz-icon nzType="inbox"></span></p>
                  <p class="ant-upload-text"><b>Click to upload</b> or drag & drop</p>
                  <p class="ant-upload-hint">PDF, Word, Excel, images. Max {{ MAX_FILES }} files.</p>
                </nz-upload>
              </nz-form-control>
            </nz-form-item>
          </div>
        </div>

        <nz-divider></nz-divider>

        <div class="actions">
          <button nz-button nzType="default" (click)="cancel()" type="button">Cancel</button>
          <button nz-button nzType="primary" [nzLoading]="loading()" type="submit">Save ticket</button>
        </div>
      </form>
    </nz-card>
  </div>
</div>
